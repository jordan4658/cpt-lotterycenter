<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.caipiao.live.common.mybatis.mapperext.lottery.LotteryMapperExt">
    <resultMap id="BaseResultMap" type="com.caipiao.live.common.mybatis.entity.Lottery">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="icon" jdbcType="CHAR" property="icon"/>
        <result column="category_id" jdbcType="INTEGER" property="categoryId"/>
        <result column="parent_id" jdbcType="INTEGER" property="parentId"/>
        <result column="startlotto_table" jdbcType="VARCHAR" property="startlottoTable"/>
        <result column="startlotto_times" jdbcType="INTEGER" property="startlottoTimes"/>
        <result column="clearing_tag" jdbcType="VARCHAR" property="clearingTag"/>
        <result column="cache_tag" jdbcType="VARCHAR" property="cacheTag"/>
        <result column="max_odds" jdbcType="DOUBLE" property="maxOdds"/>
        <result column="min_odds" jdbcType="DOUBLE" property="minOdds"/>
        <result column="sort" jdbcType="INTEGER" property="sort"/>
        <result column="push_source" jdbcType="VARCHAR" property="pushSource"/>
        <result column="push_status" jdbcType="INTEGER" property="pushStatus"/>
        <result column="video_url" jdbcType="VARCHAR" property="videoUrl"/>
        <result column="video_start" jdbcType="INTEGER" property="videoStart"/>
        <result column="is_work" jdbcType="INTEGER" property="isWork"/>
        <result column="is_delete" jdbcType="BIT" property="isDelete"/>
        <result column="lottery_id" jdbcType="INTEGER" property="lotteryId"/>
        <result column="end_time" jdbcType="INTEGER" property="endTime"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
    </resultMap>


    <select id="queryByLotteryFavorites" parameterType="com.caipiao.live.common.mybatis.entity.LotteryFavorite" resultType="java.util.Map">
        select
        l.id, l.name, l.icon, l.category_id categoryId, l.sort, l.lottery_id lotteryId, l.is_work isWork,
        l.end_time endTime, lc.name cateName, lc.sort categorySort, lc.alias intro, lc.is_work isWork
        from lottery l
        inner join lottery_category lc on(l.category_id = lc.category_id)
        where lc.is_delete = 0 and l.lottery_id in
        <foreach collection="lotteryFavorites" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <select id="queryLotteryCategoryAndLotteryInfo" parameterType="java.lang.String" resultType="java.util.Map">
        select
        c.id c_id, c.name c_name, c.alias c_alias, c.level c_level, c.category_id c_category_id, c.sort c_sort, c.type c_type, c.is_work c_is_work,
        l.id l_id, l.name l_name, l.icon l_icon, l.category_id l_category_id, l.parent_id l_parent_id, l.startlotto_table l_startlotto_table,
        l.startlotto_times l_startlotto_times, l.clearing_tag l_clearing_tag, l.cache_tag l_cache_tag, l.max_odds l_max_odds, l.min_odds l_min_odds, l.sort l_sort,
        l.push_source l_push_source, l.push_status l_push_status, l.video_url l_video_url, l.video_start l_video_start, l.lottery_id l_lottery_id, l.end_time l_end_time, l.is_work l_is_work
        from lottery_category c
        inner join lottery l on (c.category_id = l.category_id)
        where c.type = #{type} and c.is_delete = 0
        order by c.sort,l.sort desc;
    </select>

    <update id="deleteByCategoryId" parameterType="java.lang.Integer">
        update lottery set is_delete = 1 where category_id = #{categoryId}
    </update>

    <update id="updateWorkStatusByCategoryId" parameterType="java.lang.Integer">
        update lottery set is_work = #{workStatus} where category_id = #{categoryId}
    </update>

    <select id="selectLotteryIsWork" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT is_work FROM `lottery` where lottery_id = #{lotteryId} LIMIT 1
    </select>


    <select id="getRandomForLive" resultMap="BaseResultMap">
        select * from lottery where category_id in
        <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            #{item}
        </foreach>
        and is_delete = b'0'
        ORDER BY RAND() LIMIT 1
    </select>

    <select id="getRandomForLiveV2" resultMap="BaseResultMap">
        select * from lottery where lottery_id in( 1304,1202,2302,1106,1402,1601  )
        and is_delete = b'0'
        ORDER BY RAND() LIMIT 1
    </select>


    <select id="getLotKindList" resultType="com.caipiao.live.common.model.vo.lottery.LotteryVO">
  	SELECT lottery_id as lotkindid,name as lotname,lottery_id as lotcode,icon as kindimg
	FROM lottery
	WHERE is_delete = b'0'
	ORDER BY category_id ASC
   </select>
    <select id="getCateIdBlylLotteryId" resultType="com.caipiao.live.common.model.vo.lottery.LotteryCateidVo">
        select lottery_id as lotteryId,category_id as categoryId from lottery where is_delete = 0
    </select>

</mapper>